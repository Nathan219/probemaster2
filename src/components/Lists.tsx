import React from'react';import Paper from'@mui/material/Paper';import Stack from'@mui/material/Stack';import Typography from'@mui/material/Typography';import TextField from'@mui/material/TextField';import Button from'@mui/material/Button';import MenuItem from'@mui/material/MenuItem';import Divider from'@mui/material/Divider';import{Probe,Location,Sample}from'../utils/types';import{idbPut}from'../db/idb';export function LocationsPanel({locations,setLocations}:{locations:Record<string,Location>;setLocations:React.Dispatch<React.SetStateAction<Record<string,Location>>>;}){const[name,setName]=React.useState('');const[area,setArea]=React.useState('');const add=async()=>{if(!name||!area)return;const id=Math.random().toString(36).slice(2,10);const l:Location={id,name,area};setLocations((p:any)=>({...p,[l.id]:l}));await idbPut('locations',l);setName('');setArea('')};return(<Paper sx={{p:2}} variant='outlined'><Typography variant='subtitle2' sx={{mb:1}}>Locations</Typography><Stack direction='row' spacing={1}><TextField size='small' label='Location' value={name} onChange={e=>setName(e.target.value)}/><TextField size='small' label='Area' value={area} onChange={e=>setArea(e.target.value)}/><Button variant='contained' onClick={add}>Add</Button></Stack><Divider sx={{my:1}}/><Stack spacing={1} maxHeight={280} sx={{overflow:'auto'}}>{Object.values(locations).map((l:any)=>(<Paper key={l.id} variant='outlined' sx={{p:1}}><Typography fontWeight={600}>{l.name}</Typography><Typography variant='caption'>Area: {l.area}</Typography></Paper>))}</Stack></Paper>)}export function ProbesPanel({probes,locations,setProbes}:{probes:Record<string,Probe>;locations:Record<string,Location>;setProbes:React.Dispatch<React.SetStateAction<Record<string,Probe>>>;}){const assign=async(id:string,locationId:string|null)=>{setProbes((p:any)=>{const n={...p,[id]:{...p[id],locationId}};idbPut('probes',n[id]);return n})};return(<Paper sx={{p:2}} variant='outlined'><Typography variant='subtitle2' sx={{mb:1}}>Probes</Typography><Stack spacing={1} maxHeight={350} sx={{overflow:'auto'}}>{Object.values(probes).map((p:any)=>(<Stack key={p.id} direction='row' spacing={1} alignItems='center'><Typography sx={{fontFamily:'monospace'}}>{p.id}</Typography><TextField select size='small' label='Location' value={p.locationId||''} onChange={e=>assign(p.id,(e.target as any).value||null)} sx={{minWidth:220}}><MenuItem value=''>Unassigned</MenuItem>{Object.values(locations).map((l:any)=>(<MenuItem key={l.id} value={l.id}>{l.name} ({l.area})</MenuItem>))}</TextField></Stack>))}</Stack></Paper>)}export function LatestReadings({samples,probes,locations}:{samples:Sample[];probes:Record<string,Probe>;locations:Record<string,Location>;}){const latest:Record<string,Sample>={};for(const s of samples)latest[s.probeId]=s;return(<Paper sx={{p:2}} variant='outlined'><Typography variant='subtitle2' sx={{mb:1}}>Latest Readings</Typography><Stack spacing={1} maxHeight={350} sx={{overflow:'auto'}}>{Object.keys(probes).length===0&&<Typography variant='body2' color='text.secondary'>No probes yet.</Typography>}{Object.values(probes).map((p:any)=>{const l=p.locationId?locations[p.locationId]:null;const label=l?`${l.area} / ${l.name}`:'Unassigned';const r=latest[p.id];return(<Paper key={p.id} variant='outlined' sx={{p:1.5}}><Typography sx={{fontFamily:'monospace'}}>{p.id}</Typography><Typography variant='caption' color='text.secondary'>Location: {label}</Typography>{r?(<Stack direction='row' spacing={2} sx={{mt:0.5}}><Typography variant='body2'>CO₂: <b>{r.co2}</b></Typography><Typography variant='body2'>Temp: <b>{r.temp.toFixed(2)}</b>°C</Typography><Typography variant='body2'>Hum: <b>{r.hum.toFixed(2)}</b>%</Typography><Typography variant='body2'>Sound: <b>{r.sound}</b></Typography><Typography variant='caption' color='text.secondary'>{new Date(r.ts).toLocaleTimeString()}</Typography></Stack>):(<Typography variant='caption' color='text.secondary'>No data yet</Typography>)}</Paper>)})}</Stack></Paper>)}